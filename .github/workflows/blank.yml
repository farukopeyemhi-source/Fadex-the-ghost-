<!DOCTYPE html>
<html>
<head>
  <title>Alpha Squad - Voice Training</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: white;
      text-align: center;
      overflow: hidden;
    }
    .screen {
      display: none;
      height: 100vh;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .active {
      display: flex;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      margin-top: 20px;
      cursor: pointer;
    }
    #bar {
      width: 300px;
      height: 25px;
      border: 2px solid white;
      margin-top: 20px;
      background: #222;
      border-radius: 5px;
      overflow: hidden;
    }
    #fill {
      height: 100%;
      width: 0%;
      background: lime;
      transition: width 0.1s;
    }
    .drone {
      position: absolute;
      width: 50px;
      height: 50px;
      background: cyan;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: transform 0.2s;
    }
  </style>
</head>
<body>

<!-- Splash -->
<div id="splash" class="screen active">
  <h1>Fadex the Ghost</h1>
</div>

<!-- Menu -->
<div id="menu" class="screen">
  <h1>Alpha Squad</h1>
  <button onclick="startGame()">Start Mission</button>
</div>

<!-- Game -->
<div id="game" class="screen">
  <h2>Mission: Sound Training</h2>
  <p>Shout to push the drones!</p>
  <div id="bar"><div id="fill"></div></div>
  <h3 id="result"></h3>
  <div id="drones-container"></div>
</div>

<script>
let splash = document.getElementById("splash");
let menu = document.getElementById("menu");
let game = document.getElementById("game");
let fill = document.getElementById("fill");
let result = document.getElementById("result");
let dronesContainer = document.getElementById("drones-container");
let drones = [];

// Splash â†’ Menu
setTimeout(() => {
  splash.classList.remove("active");
  menu.classList.add("active");
}, 2000);

// Start Game
function startGame() {
  menu.classList.remove("active");
  game.classList.add("active");
  spawnDrones(5); // spawn 5 drones
  startMic();
}

// Create drones
function spawnDrones(count) {
  for (let i = 0; i < count; i++) {
    let drone = document.createElement("div");
    drone.classList.add("drone");
    drone.style.top = Math.random() * 80 + 10 + "%";
    drone.style.left = Math.random() * 80 + 10 + "%";
    dronesContainer.appendChild(drone);
    drones.push(drone);
  }
}

// Voice input
async function startMic() {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const audioCtx = new AudioContext();
  const source = audioCtx.createMediaStreamSource(stream);
  const analyser = audioCtx.createAnalyser();
  source.connect(analyser);
  analyser.fftSize = 256;
  const data = new Uint8Array(analyser.frequencyBinCount);

  function listen() {
    analyser.getByteFrequencyData(data);
    let volume = data.reduce((a,b) => a+b) / data.length;
    let percent = Math.min((volume / 128) * 100, 100); // normalize
    fill.style.width = percent + "%";

    // Push drones based on shout strength
    drones.forEach(drone => {
      let rect = drone.getBoundingClientRect();
      let pushX = (Math.random() - 0.5) * percent * 0.5;
      let pushY = (Math.random() - 0.5) * percent * 0.5;
      drone.style.transform = `translate(${pushX}px, ${pushY}px)`;
    });

    // Check if mission complete (all drones pushed far enough)
    let completed = drones.every(drone => {
      let t = drone.style.transform.match(/translate\(([-0-9.]+)px, ([-0-9.]+)px\)/);
      if (!t) return false;
      return Math.abs(parseFloat(t[1])) > 50 || Math.abs(parseFloat(t[2])) > 50;
    });
    if (completed) {
      result.innerText = "MISSION COMPLETE!";
      return; // stop listening
    }

    requestAnimationFrame(listen);
  }

  listen();
}
</script>

</body>
</html>
